@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    /* ── Surface & Background ── */
    --color-surface: #ffffff;
    --color-surface-subtle: #f9fafb; /* gray-50 */
    --color-surface-muted: #f3f4f6; /* gray-100 */
    --color-surface-overlay: rgba(0, 0, 0, 0.5);

    /* ── Text ── */
    --color-text-primary: #111827; /* gray-900 */
    --color-text-secondary: #4b5563; /* gray-600 — WCAG AA 7.08:1 on white, 4.78:1 on surface-muted */
    --color-text-muted: #6b7280; /* gray-500 — WCAG AA 4.63:1 on white */
    --color-text-inverse: #ffffff;

    /* ── Border & Divider ── */
    --color-border: #e5e7eb; /* gray-200 */
    --color-border-strong: #d1d5db; /* gray-300 */

    /* ── Brand (Primary Action) ── */
    --color-brand: #15803d; /* green-700 — 5:1 contrast on white (WCAG AA) */
    --color-brand-hover: #166534; /* green-800 */
    --color-brand-subtle: #dcfce7; /* brand-100 */

    /* ── Health Score Bands ── */
    --color-score-green: #22c55e; /* 1–20 */
    --color-score-yellow: #eab308; /* 21–40 */
    --color-score-orange: #f97316; /* 41–60 */
    --color-score-red: #ef4444; /* 61–80 */
    --color-score-darkred: #991b1b; /* 81–100 */

    /* ── Nutri-Score (EU standard colors) ── */
    --color-nutri-A: #038141;
    --color-nutri-B: #85bb2f;
    --color-nutri-C: #fecb02;
    --color-nutri-D: #ee8100;
    --color-nutri-E: #e63e11;

    /* ── Nutrition Traffic Light (FSA/EFSA) ── */
    --color-nutrient-low: #22c55e; /* green — low risk */
    --color-nutrient-medium: #f59e0b; /* amber — moderate */
    --color-nutrient-high: #ef4444; /* red — high risk */

    /* ── NOVA Processing Groups ── */
    --color-nova-1: #22c55e; /* Unprocessed */
    --color-nova-2: #84cc16; /* Processed culinary */
    --color-nova-3: #f59e0b; /* Processed */
    --color-nova-4: #ef4444; /* Ultra-processed */

    /* ── Confidence Bands ── */
    --color-confidence-high: #22c55e;
    --color-confidence-medium: #f59e0b;
    --color-confidence-low: #ef4444;

    /* ── Allergen Severity ── */
    --color-allergen-present: #ef4444; /* Contains allergen */
    --color-allergen-traces: #f59e0b; /* May contain traces */
    --color-allergen-free: #22c55e; /* Free from */

    /* ── Semantic Feedback ── */
    --color-success: #22c55e;
    --color-warning: #f59e0b;
    --color-error: #ef4444;
    --color-info: #3b82f6;

    /* ── Toast (feedback overlays) ── */
    --toast-success: #16a34a;
    --toast-error: #dc2626;
    --toast-warning: #d97706;
    --toast-info: #2563eb;

    /* ── Elevation (Shadows) ── */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);

    /* ── Spacing Scale (4px base) ── */
    --space-1: 0.25rem; /* 4px */
    --space-2: 0.5rem; /* 8px */
    --space-3: 0.75rem; /* 12px */
    --space-4: 1rem; /* 16px */
    --space-5: 1.25rem; /* 20px */
    --space-6: 1.5rem; /* 24px */
    --space-8: 2rem; /* 32px */
    --space-10: 2.5rem; /* 40px */
    --space-12: 3rem; /* 48px */
    --space-16: 4rem; /* 64px */

    /* ── Typography Scale ── */
    --text-xs: 0.75rem; /* 12px */
    --text-sm: 0.875rem; /* 14px */
    --text-base: 1rem; /* 16px */
    --text-lg: 1.125rem; /* 18px */
    --text-xl: 1.25rem; /* 20px */
    --text-2xl: 1.5rem; /* 24px */
    --text-3xl: 1.875rem; /* 30px */

    --font-normal: 400;
    --font-medium: 500;
    --font-semibold: 600;
    --font-bold: 700;

    --leading-tight: 1.25;
    --leading-normal: 1.5;
    --leading-relaxed: 1.625;

    /* ── Border Radius ── */
    --radius-sm: 0.375rem; /* 6px */
    --radius-md: 0.5rem; /* 8px */
    --radius-lg: 0.75rem; /* 12px */
    --radius-xl: 1rem; /* 16px */
    --radius-full: 9999px;

    /* ── Transitions ── */
    --transition-fast: 150ms ease;
    --transition-normal: 200ms ease;
    --transition-slow: 300ms ease;

    /* ── Motion (#61) ── */
    --ease-standard: cubic-bezier(0.4, 0, 0.2, 1);
    --ease-decelerate: cubic-bezier(0, 0, 0.2, 1);
    --ease-accelerate: cubic-bezier(0.4, 0, 1, 1);
    --ease-spring: cubic-bezier(0.68, -0.55, 0.265, 1.55);

    --duration-instant: 100ms;
    --duration-fast: 150ms;
    --duration-normal: 200ms;
    --duration-slow: 300ms;
  }

  /* ── Dark mode overrides ── */
  [data-theme="dark"] {
    --color-surface: #111827; /* gray-900 */
    --color-surface-subtle: #1f2937; /* gray-800 */
    --color-surface-muted: #374151; /* gray-700 */
    --color-surface-overlay: rgba(0, 0, 0, 0.7);

    --color-text-primary: #f9fafb; /* gray-50 */
    --color-text-secondary: #d1d5db; /* gray-300 */
    --color-text-muted: #9ca3af; /* gray-400 */
    --color-text-inverse: #111827;

    --color-border: #374151; /* gray-700 */
    --color-border-strong: #4b5563; /* gray-600 */

    --color-brand: #4ade80; /* green-400 — WCAG AA 5.4:1 on brand-subtle */
    --color-brand-hover: #22c55e; /* green-500 */
    --color-brand-subtle: #14532d; /* green-900 */

    /* Score bands — same hues, adjusted lightness for dark backgrounds */
    --color-score-green: #4ade80;
    --color-score-yellow: #facc15;
    --color-score-orange: #fb923c;
    --color-score-red: #f87171;
    --color-score-darkred: #dc2626;

    /* Nutri-Score — brightened for dark mode contrast */
    --color-nutri-A: #34d399;
    --color-nutri-B: #a3e635;
    --color-nutri-C: #fde047;
    --color-nutri-D: #fb923c;
    --color-nutri-E: #f87171;

    --color-nutrient-low: #4ade80;
    --color-nutrient-medium: #fbbf24;
    --color-nutrient-high: #f87171;

    --color-nova-1: #4ade80;
    --color-nova-2: #a3e635;
    --color-nova-3: #fbbf24;
    --color-nova-4: #f87171;

    --color-confidence-high: #4ade80;
    --color-confidence-medium: #fbbf24;
    --color-confidence-low: #f87171;

    --color-allergen-present: #f87171;
    --color-allergen-traces: #fbbf24;
    --color-allergen-free: #4ade80;

    --color-success: #4ade80;
    --color-warning: #fbbf24;
    --color-error: #f87171;
    --color-info: #60a5fa;

    --toast-success: #4ade80;
    --toast-error: #f87171;
    --toast-warning: #fbbf24;
    --toast-info: #60a5fa;

    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
  }

  /* System-preference dark mode fallback (used until data-theme is set) */
  @media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) {
      --color-surface: #111827;
      --color-surface-subtle: #1f2937;
      --color-surface-muted: #374151;
      --color-surface-overlay: rgba(0, 0, 0, 0.7);

      --color-text-primary: #f9fafb;
      --color-text-secondary: #d1d5db;
      --color-text-muted: #9ca3af;
      --color-text-inverse: #111827;

      --color-border: #374151;
      --color-border-strong: #4b5563;

      --color-brand: #4ade80;
      --color-brand-hover: #22c55e;
      --color-brand-subtle: #14532d;

      --color-score-green: #4ade80;
      --color-score-yellow: #facc15;
      --color-score-orange: #fb923c;
      --color-score-red: #f87171;
      --color-score-darkred: #dc2626;

      --color-nutri-A: #34d399;
      --color-nutri-B: #a3e635;
      --color-nutri-C: #fde047;
      --color-nutri-D: #fb923c;
      --color-nutri-E: #f87171;

      --color-nutrient-low: #4ade80;
      --color-nutrient-medium: #fbbf24;
      --color-nutrient-high: #f87171;

      --color-nova-1: #4ade80;
      --color-nova-2: #a3e635;
      --color-nova-3: #fbbf24;
      --color-nova-4: #f87171;

      --color-confidence-high: #4ade80;
      --color-confidence-medium: #fbbf24;
      --color-confidence-low: #f87171;

      --color-allergen-present: #f87171;
      --color-allergen-traces: #fbbf24;
      --color-allergen-free: #4ade80;

      --color-success: #4ade80;
      --color-warning: #fbbf24;
      --color-error: #f87171;
      --color-info: #60a5fa;

      --toast-success: #4ade80;
      --toast-error: #f87171;
      --toast-warning: #fbbf24;
      --toast-info: #60a5fa;

      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4);
    }
  }

  html {
    /* Prevent pull-to-refresh in standalone PWA mode */
    overscroll-behavior-y: contain;
    /* Smooth momentum scrolling on iOS */
    -webkit-overflow-scrolling: touch;
    /* Prevent any descendant from widening the mobile layout viewport */
    overflow-x: hidden;
  }

  body {
    @apply bg-surface-subtle text-foreground antialiased;
    /* Horizontal safe-area insets for viewport-fit=cover on notched/foldable
       devices — prevents layout from extending into side safe areas. */
    padding-left: env(safe-area-inset-left, 0px);
    padding-right: env(safe-area-inset-right, 0px);
    /* Prevent text selection / callout on long-press in PWA */
    -webkit-tap-highlight-color: transparent;
    /* Smooth theme transitions (150ms) — disabled during initial load */
    transition: background-color 150ms ease, color 150ms ease;
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    body {
      transition: none;
    }
    :root {
      --duration-instant: 0ms;
      --duration-fast: 0ms;
      --duration-normal: 0ms;
      --duration-slow: 0ms;
    }
  }
}

@layer components {
  .btn-primary {
    @apply inline-flex items-center justify-center rounded-lg bg-brand px-4 py-2.5
           text-sm font-semibold text-foreground-inverse shadow-sm transition-colors
           cursor-pointer hover:bg-brand-hover focus-visible:outline-2 focus-visible:outline-offset-2
           focus-visible:outline-brand disabled:opacity-50 disabled:cursor-not-allowed
           press-scale;
    /* Prevent double-tap zoom on buttons in PWA */
    touch-action: manipulation;
  }

  .btn-secondary {
    @apply inline-flex items-center justify-center rounded-lg border border-strong
           bg-surface px-4 py-2.5 text-sm font-semibold text-foreground-secondary shadow-sm
           transition-colors cursor-pointer hover:bg-surface-subtle focus-visible:outline-2
           focus-visible:outline-offset-2 focus-visible:outline-brand
           disabled:opacity-50 disabled:cursor-not-allowed
           press-scale;
    touch-action: manipulation;
  }

  .input-field {
    @apply block w-full rounded-lg border border-strong bg-surface px-3.5 py-2.5
           text-sm text-foreground shadow-sm placeholder:text-foreground-muted
           focus:border-brand focus:ring-1 focus:ring-brand focus:outline-none;
  }

  .card {
    @apply rounded-xl border bg-surface p-3 shadow-sm sm:p-4 lg:p-5;
  }

  /* ── Motion Utility Classes (#61) ── */
  .transition-interactive {
    transition: transform var(--duration-fast) var(--ease-standard),
                opacity var(--duration-fast) var(--ease-standard),
                box-shadow var(--duration-fast) var(--ease-standard);
    will-change: transform;
  }

  .hover-lift {
    transition: transform var(--duration-fast) var(--ease-standard),
                opacity var(--duration-fast) var(--ease-standard),
                box-shadow var(--duration-fast) var(--ease-standard);
  }
  @media (hover: hover) {
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1));
    }
  }

  .press-scale {
    transition: transform var(--duration-instant) var(--ease-standard);
  }
  .press-scale:active {
    transform: scale(0.97);
  }

  .hover-lift-press {
    transition: transform var(--duration-fast) var(--ease-standard),
                box-shadow var(--duration-fast) var(--ease-standard);
    cursor: pointer;
  }
  @media (hover: hover) {
    .hover-lift-press:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md, 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1));
    }
  }
  .hover-lift-press:active {
    transform: translateY(0) scale(0.97);
    box-shadow: none;
  }
}

/* ── Global focus-visible indicator for all interactive elements ── */
*:focus-visible {
  outline: 2px solid var(--color-brand);
  outline-offset: 2px;
  border-radius: 2px;
}

/* Remove default outline when :focus-visible is not active */
*:focus:not(:focus-visible) {
  outline: none;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(1rem);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes slideUpSheet {
  from {
    transform: translateY(100%);
  }
  to {
    transform: translateY(0);
  }
}

.animate-slide-up-sheet {
  animation: slideUpSheet var(--duration-slow) var(--ease-decelerate);
}

/* ── Dialog / Modal animations (#61) ── */
@keyframes dialogIn {
  from {
    opacity: 0;
    transform: scale(0.95);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes backdropIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(0.5rem);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* ── Staggered entrance for lists (#61) ── */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(0.5rem);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ── Skeleton shimmer animation ── */
@keyframes shimmer {
  0% {
    background-position: -200% 0;
  }
  100% {
    background-position: 200% 0;
  }
}

.skeleton {
  background: linear-gradient(
    90deg,
    var(--color-surface-muted) 25%,
    var(--color-surface-subtle) 50%,
    var(--color-surface-muted) 75%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s ease-in-out infinite;
  border-radius: var(--radius-md);
}

@media (prefers-reduced-motion: reduce) {
  .skeleton {
    animation: none;
    background: var(--color-surface-muted);
  }

  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ── Touch Target Utilities ── */
.touch-target {
  position: relative;
  min-height: 44px;
  min-width: 44px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

/* Expand hit area beyond visual bounds for small interactive elements */
.touch-target-expanded {
  position: relative;
}
.touch-target-expanded::after {
  content: "";
  position: absolute;
  inset: -8px;
  min-width: 44px;
  min-height: 44px;
}

/* ── Container Query Definitions ── */
.product-card-container {
  container-type: inline-size;
}

.compare-cell-container {
  container-type: inline-size;
}

.filter-panel-container {
  container-type: inline-size;
}

/* ── Safe Area Insets ── */
.safe-area-bottom {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.safe-area-top {
  padding-top: env(safe-area-inset-top, 0px);
}

/* ── Scrollbar Hide ── */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* ══════════════════════════════════════════════════════════════════════════
   Print Styles — A4-optimized for product profile + compare pages
   All rules scoped to @media print so screen layout is unaffected.
   ══════════════════════════════════════════════════════════════════════════ */

@media print {
  /* ── Page setup ── */
  @page {
    margin: 15mm;
  }

  /* Compare page uses landscape for side-by-side columns */
  @page compare {
    size: A4 landscape;
    margin: 12mm;
  }

  .compare-print-container {
    page: compare;
  }

  /* ── Reset to paper-safe styles ── */
  html,
  body {
    background: white !important;
    color: black !important;
    font-size: 11pt !important;
    line-height: 1.4 !important;
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* ── Hide non-content elements ── */
  nav,
  footer,
  aside,
  [data-no-print],
  .no-print,
  [role="dialog"],
  [role="tooltip"],
  [role="tablist"],
  .skeleton {
    display: none !important;
  }

  /* ── Remove decorative styles ── */
  * {
    box-shadow: none !important;
    text-shadow: none !important;
  }

  /* ── Remove sticky/fixed positioning ── */
  header,
  [class*="sticky"],
  [class*="fixed"] {
    position: static !important;
  }

  /* ── Remove backdrop-blur ── */
  [class*="backdrop-blur"] {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    background-color: transparent !important;
  }

  /* ── Prevent page breaks inside cards ── */
  .card,
  .print-no-break {
    break-inside: avoid;
    border: 1px solid #d1d5db !important;
  }

  /* ── Force page break ── */
  .print-page-break {
    break-before: page;
  }

  /* ── Remove transitions/animations ── */
  * {
    transition: none !important;
    animation: none !important;
  }

  /* ── Show URLs for external links ── */
  a[href^="http"]:not(.no-print-url)::after {
    content: " (" attr(href) ")";
    font-size: 9pt;
    color: #666;
    word-break: break-all;
  }

  /* ── Internal links: don't show URL ── */
  a[href^="/"]::after {
    content: none !important;
  }

  /* ── Surface/card transparent backgrounds ── */
  .bg-surface,
  .bg-surface-subtle,
  .bg-surface-muted {
    background-color: white !important;
  }

  /* ── Keep brand/score colors for data readability ── */
  [class*="bg-score-"],
  [class*="bg-nutri-"],
  [class*="bg-nova-"],
  [class*="bg-brand"] {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* ── Print footer attribution ── */
  body::after {
    content: "Poland Food DB — poland-food-db.vercel.app";
    display: block;
    text-align: center;
    font-size: 8pt;
    color: #999;
    margin-top: 24pt;
    padding-top: 8pt;
    border-top: 1px solid #e5e7eb;
  }

  /* ── Responsive images for print ── */
  img {
    max-width: 200px !important;
    height: auto !important;
  }
}
